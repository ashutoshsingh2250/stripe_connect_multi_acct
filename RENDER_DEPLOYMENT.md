# 🚀 Render Deployment Guide

## 📋 Prerequisites

-   Render account
-   Git repository with your code
-   SMTP credentials for email functionality

## 🔧 Render Service Setup

### 1. Create New Web Service

-   Go to [Render Dashboard](https://dashboard.render.com/)
-   Click "New +" → "Web Service"
-   Connect your Git repository

### 2. Service Configuration

**Basic Settings:**

-   **Name:** `stripe-connect-app` (or your preferred name)
-   **Environment:** `Node`
-   **Region:** Choose closest to your users
-   **Branch:** `main` (or your default branch)

**Build & Deploy:**

-   **Build Command:** `cd server-nest && npm install && npm run build`
-   **Start Command:** `cd server-nest && npm run start:prod`

### 3. Environment Variables

Set these in your Render service:

| Key          | Value                                | Description                    |
| ------------ | ------------------------------------ | ------------------------------ |
| `NODE_ENV`   | `production`                         | Environment mode               |
| `PORT`       | `10000`                              | Server port (Render sets this) |
| `JWT_SECRET` | `[generate]`                         | JWT encryption secret          |
| `SMTP_HOST`  | `smtp.gmail.com`                     | SMTP server host               |
| `SMTP_PORT`  | `587`                                | SMTP server port               |
| `SMTP_USER`  | `your-email@gmail.com`               | Your email address             |
| `SMTP_PASS`  | `your-app-password`                  | Your email app password        |
| `CLIENT_URL` | `https://your-app-name.onrender.com` | Your Render domain             |

### 4. Health Check

-   **Health Check Path:** `/health`
-   **Auto-Deploy:** Enable for automatic deployments

## 🔐 SMTP Setup (Gmail Example)

1. **Enable 2-Factor Authentication** on your Gmail account
2. **Generate App Password:**
    - Go to Google Account settings
    - Security → 2-Step Verification → App passwords
    - Generate password for "Mail"
3. **Use the generated password** as `SMTP_PASS`

## 📁 Project Structure for Render

```
stripe_connect_multi_acct/
├── render.yaml                 # Render configuration
├── package.json               # Root package.json
├── client/                    # React frontend
│   ├── build/                # Production build (generated)
│   └── package.json
└── server-nest/              # NestJS backend
    ├── dist/                 # Production build (generated)
    ├── package.json
    └── src/
```

## 🚀 Deployment Process

1. **Push to Git:** Your changes will trigger auto-deploy
2. **Build Phase:** Render installs dependencies and builds the NestJS app
3. **Start Phase:** Server starts with `npm run start:prod`
4. **Health Check:** Render verifies `/health` endpoint responds
5. **Live:** Your app is accessible at the Render URL

## 🔍 Troubleshooting

### Build Failures

-   Check build logs in Render dashboard
-   Ensure all dependencies are in `package.json`
-   Verify Node.js version compatibility

### Runtime Errors

-   Check application logs in Render dashboard
-   Verify environment variables are set correctly
-   Ensure SMTP credentials are valid

### Health Check Failures

-   Verify `/health` endpoint exists and responds
-   Check if server is starting correctly
-   Review start command and port configuration

## 📱 Frontend Configuration

The React app will be served from the NestJS server in production:

-   Static files served from `/client/build`
-   SPA routing handled by NestJS
-   API calls go to `/api/*` endpoints

## 🔒 Security Notes

-   JWT_SECRET is auto-generated by Render
-   SMTP credentials are encrypted in Render
-   Stripe keys are encrypted by frontend before sending
-   CORS is configured for production domain

## 📞 Support

If you encounter issues:

1. Check Render deployment logs
2. Verify environment variables
3. Test locally with `npm run dev`
4. Check server-nest logs for errors

---

**Happy Deploying! 🎉**
